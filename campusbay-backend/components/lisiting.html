<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CAMPUSBAY - My Listings</title>
  <link rel="stylesheet" href="listing.css" />
</head>
<body>
  <header>
    <nav class="navbar">
      <div class="logo"><a href="home.html">CAMPUSBAY</a></div>
      <ul class="nav-links">
        <li><a href="browse.html">Browse</a></li>
        <li><a href="listing.html" class="active">My Listings</a></li>
        <li><a href="message.html">Messages</a></li>
        <li><a href="#">Profile</a></li>
      </ul>
      <div class="profile-icon">
        <span>ðŸ‘¤</span>
      </div>
    </nav>
  </header>

  <main>
    <div class="listings-dashboard">
      <div class="dashboard-header">
        <h2>My Listings</h2>
        <p>Manage your posted products and create new listings</p>
      </div>

      <div class="listings-controls">
        <div class="tabs">
          <button class="tab active">All</button>
        </div>
        <button class="new-listing-btn" onclick="location.href='post-listing.html'">+ Post New Listing</button>
      </div>

      <div id="listingsContainer" class="listings-grid">
        <!-- Example Listing Card -->
        <div class="listing-card">
            <div class="listing-title-row">
            <span class="listing-type">MacBook Pro 2023</span>
            <span class="listing-status active">Active</span>
            </div>
            <div class="listing-title">MacBook Pro 13" M2</div>
            <div class="listing-price">$1200</div>
            <div class="listing-meta">Condition: Excellent</div>
            <div class="listing-meta">Posted: 12/07/2025</div>
            <div class="listing-actions">
            <button class="edit-btn">Edit</button>
            <button class="delete-btn" onclick="deleteListing('LISTING_ID')">Delete</button>
            </div>
        </div>

        <div class="listing-card">
            <div class="listing-title-row">
            <span class="listing-type">Calculus Textbook</span>
            <span class="listing-status sold">Sold</span>
            </div>
            <div class="listing-title">Calculus: Early Transcendentals</div>
            <div class="listing-price">$45</div>
            <div class="listing-meta">Condition: Good</div>
            <div class="listing-meta">Sold: 10/07/2025</div>
            <div class="listing-actions">
            <button class="view-btn">View</button>
            <button class="delete-btn" onclick="deleteListing('LISTING_ID')">Delete</button>
            </div>
        </div>

        <!-- More listing cards will be added dynamically by JavaScript -->
        </div>


      <div class="pagination">
        <button>&lt;</button>
        <button class="active">1</button>
        <button>2</button>
        <button>3</button>
        <button>&gt;</button>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-bottom">
      <span>&copy; 2025 CAMPUSBAY. All rights reserved.</span>
    </div>
  </footer>

  <script>
    const userId = "64fc2e7a53d1cd5b7fc9b8d1"; // Replace this with the actual logged-in user ID (from JWT or session)

    async function fetchMyListings() {
      try {
        const res = await fetch(`/api/listings?userId=${userId}`);
        const listings = await res.json();
        const container = document.getElementById("listingsContainer");
        container.innerHTML = "";

        if (listings.length === 0) {
          container.innerHTML = "<p>No listings found.</p>";
          return;
        }

        listings.forEach((listing) => {
          const card = document.createElement("div");
          card.className = "listing-card";
          card.innerHTML = `
            <div class="listing-title-row">
              <span class="listing-type">${listing.title}</span>
              <span class="listing-status active">Active</span>
            </div>
            <div class="listing-title">${listing.description}</div>
            <div class="listing-price">$${listing.price}</div>
            <div class="listing-meta">Condition: ${listing.condition || "Good"}</div>
            <div class="listing-meta">Posted: ${new Date(listing.createdAt).toLocaleDateString()}</div>
            <div class="listing-actions">
              <button class="edit-btn">Edit</button>
              <button class="delete-btn" onclick="deleteListing('${listing._id}')">Delete</button>
            </div>
          `;
          container.appendChild(card);
        });
      } catch (err) {
        console.error("Failed to fetch listings:", err);
      }
    }

    async function deleteListing(id) {
      if (!confirm("Are you sure you want to delete this listing?")) return;
      try {
        const res = await fetch(`/api/listings/${id}`, { method: "DELETE" });
        if (res.ok) {
          alert("Deleted successfully.");
          fetchMyListings();
        } else {
          alert("Failed to delete listing.");
        }
      } catch (err) {
        console.error(err);
        alert("Error deleting listing.");
      }
    }

    window.onload = fetchMyListings;
  </script>
</body>
</html>
